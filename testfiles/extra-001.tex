\documentclass{article}
\usepackage[b5paper,margin=1cm]{geometry}
\pagestyle{empty}

\input{regression-test}

\usepackage{array}
\usepackage{tabularray}
\usepackage{environ}

\SetTblrTracing{none}
\UseTblrLibrary{varwidth}

\begin{document}

\START
\hrule\bigskip


\def\tblrbody{
 \hline
  20 & 30 & 40 \\
  50 & 60 & 70 \\
 \hline
}%
\BEGINTEST{testing expand option, simple}
\begin{tblr}[expand=\tblrbody]{ccc}
 \hline
  AA & BB & CC \\
  \tblrbody
  DD & EE & FF \\
  \tblrbody
  GG & HH & II \\
 \hline
\end{tblr}
\ENDTEST
\qquad
%
\def\tblrbodya{
 \hline
  20 & 30 & 40 \\
}%
\def\tblrbodyb{
  50 & 60 & 70 \\
 \hline
}%
\BEGINTEST{testing expand option, clist value}
\begin{tblr}[expand={\tblrbody, \tblrbodya, \tblrbodyb}]{ccc}
 \hline
  AA & BB & CC \\
  \tblrbody
  DD & EE & FF \\
  \tblrbodya
  \tblrbodyb
  GG & HH & II \\
 \hline
\end{tblr}
\ENDTEST

\bigskip

\BEGINTEST{testing expand option, empty and non-single items}
\begin{tblr}[expand={\tblrbody, , \tblrbodya, abc, \tblrbodyb}]{ccc}
 \hline
  AA & BB & CC \\
  \tblrbody
  DD & EE & FF \\
  \tblrbodya
  \tblrbodyb
  GG & HH & II \\
 \hline
\end{tblr}
\ENDTEST
\qquad
%
\def\tblrbodyc{
  \tblrbodya
  \tblrbodyb
}%
\BEGINTEST{testing expand option, expansion order}
\begin{tblr}[expand={\tblrbodyc, \tblrbodya, \tblrbodyb}]{ccc}
 \hline
  AA & BB & CC \\
  \tblrbodyc
  DD & EE & FF \\
  \tblrbodya
  \tblrbodyb
  GG & HH & II \\
 \hline
\end{tblr}
\ENDTEST

\bigskip\hrule\bigskip

\BEGINTEST{testing \NewEnviron}
\NewEnviron{fancytblr}[1]{
 Before Text
 \begin{tblr}[expand=\BODY]{#1}
   \BODY
 \end{tblr}
 After Text
}
\begin{fancytblr}{hlines}
  One   & Two   & Three \\
  Four  & Five  & Six   \\
  Seven & Eight & Nine  \\
\end{fancytblr}
\ENDTEST

\end{document}
